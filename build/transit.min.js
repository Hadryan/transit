!Backbone&&typeof require!="undefined"&&(Backbone=require("backbone")),!_&&typeof require!="undefined"&&(_=require("underscore"));var root=this;Backbone.Marionette=function(e,t,n){var r={};r.EventBinder=function(){this._eventBindings=[]},t.extend(r.EventBinder.prototype,{bindTo:function(e,t,n,r){r=r||this,e.on(t,n,r);var i={obj:e,eventName:t,callback:n,context:r};return this._eventBindings.push(i),i},unbindFrom:function(e){e.obj.off(e.eventName,e.callback,e.context),this._eventBindings=t.reject(this._eventBindings,function(t){return t===e})},unbindAll:function(){var e=this,n=t.map(this._eventBindings,t.identity);t.each(n,function(t,n){e.unbindFrom(t)})}}),r.EventBinder.extend=e.View.extend,r.View=e.View.extend({constructor:function(){var n=new r.EventBinder;t.extend(this,n),e.View.prototype.constructor.apply(this,arguments),this.bindBackboneEntityTo(this.model,this.modelEvents),this.bindBackboneEntityTo(this.collection,this.collectionEvents),this.bindTo(this,"show",this.onShowCalled,this)},getTemplate:function(){var e;return this.options&&this.options.template?e=this.options.template:e=this.template,e},serializeData:function(){var e;return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e=this.mixinTemplateHelpers(e),e},mixinTemplateHelpers:function(e){e=e||{};var n=this.templateHelpers;return t.isFunction(n)&&(n=n.call(this)),t.extend(e,n)},configureTriggers:function(){if(!this.triggers)return;var e=this.triggers,n=this,r={};return t.isFunction(e)&&(e=e.call(this)),t.each(e,function(e,t){r[t]=function(t){t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),n.trigger(e)}}),r},delegateEvents:function(n){n=n||this.events,t.isFunction(n)&&(n=n.call(this));var r={},i=this.configureTriggers();t.extend(r,n,i),e.View.prototype.delegateEvents.call(this,r)},onShowCalled:function(){},close:function(){this.beforeClose&&this.beforeClose(),this.remove(),this.onClose&&this.onClose(),this.trigger("close"),this.unbindAll(),this.unbind()},bindUIElements:function(){if(!this.ui)return;var e=this;this.uiBindings||(this.uiBindings=this.ui),this.ui={},t.each(t.keys(this.uiBindings),function(t){var n=e.uiBindings[t];e.ui[t]=e.$(n)})},bindBackboneEntityTo:function(e,n){if(!e||!n)return;var r=this;t.each(n,function(t,n){var i=r[t];if(!i)throw new Error("View method '"+t+"' was configured as an event handler, but does not exist.");r.bindTo(e,n,i,r)})}}),r.ItemView=r.View.extend({constructor:function(){r.View.prototype.constructor.apply(this,arguments),this.initialEvents&&this.initialEvents()},render:function(){this.beforeRender&&this.beforeRender(),this.trigger("before:render",this),this.trigger("item:before:render",this);var e=this.serializeData(),t=this.getTemplate(),n=r.Renderer.render(t,e);return this.$el.html(n),this.bindUIElements(),this.onRender&&this.onRender(),this.trigger("render",this),this.trigger("item:rendered",this),this},close:function(){this.trigger("item:before:close"),r.View.prototype.close.apply(this,arguments),this.trigger("item:closed")}}),r.CollectionView=r.View.extend({constructor:function(){r.View.prototype.constructor.apply(this,arguments),this.initChildViewStorage(),this.initialEvents(),this.onShowCallbacks=new r.Callbacks},initialEvents:function(){this.collection&&(this.bindTo(this.collection,"add",this.addChildView,this),this.bindTo(this.collection,"remove",this.removeItemView,this),this.bindTo(this.collection,"reset",this.render,this))},addChildView:function(e,t,n){this.closeEmptyView();var r=this.getItemView(e);return this.addItemView(e,r,n.index)},onShowCalled:function(){this.onShowCallbacks.run()},triggerBeforeRender:function(){this.beforeRender&&this.beforeRender(),this.trigger("before:render",this),this.trigger("collection:before:render",this)},triggerRendered:function(){this.onRender&&this.onRender(),this.trigger("render",this),this.trigger("collection:rendered",this)},render:function(){return this.triggerBeforeRender(),this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView(),this.triggerRendered(),this},showCollection:function(){var e=this,t;this.collection.each(function(n,r){t=e.getItemView(n),e.addItemView(n,t,r)})},showEmptyView:function(){var t=this.options.emptyView||this.emptyView;if(t&&!this._showingEmptyView){this._showingEmptyView=!0;var n=new e.Model;this.addItemView(n,t,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getItemView:function(e){var t=this.options.itemView||this.itemView;if(!t){var n=new Error("An `itemView` must be specified");throw n.name="NoItemViewError",n}return t},addItemView:function(e,t,n){var r=this,s=this.buildItemView(e,t);this.storeChild(s),this.onItemAdded&&this.onItemAdded(s),this.trigger("item:added",s);var o=this.renderItemView(s,n);s.onShow&&this.onShowCallbacks.add(s.onShow,s);var u=this.bindTo(s,"all",function(){var e=i.call(arguments);e[0]="itemview:"+e[0],e.splice(1,0,s),r.trigger.apply(r,e)});return this.childBindings=this.childBindings||{},this.childBindings[s.cid]=u,o},renderItemView:function(e,t){e.render(),this.appendHtml(this,e,t)},buildItemView:function(e,n){var r=t.result(this,"itemViewOptions"),i=t.extend({model:e},r),s=new n(i);return s},removeItemView:function(e){var t=this.children[e.cid];if(t){var n=this.childBindings[t.cid];n&&(this.unbindFrom(n),delete this.childBindings[t.cid]),t.close(),delete this.children[e.cid]}(!this.collection||this.collection.length===0)&&this.showEmptyView(),this.trigger("item:removed",t)},appendHtml:function(e,t,n){e.$el.append(t.el)},storeChild:function(e){this.children[e.model.cid]=e},initChildViewStorage:function(){this.children={}},close:function(){this.trigger("collection:before:close"),this.closeChildren(),this.trigger("collection:closed"),r.View.prototype.close.apply(this,arguments)},closeChildren:function(){var e=this;this.children&&t.each(t.clone(this.children),function(t){e.removeItemView(t.model)})}}),r.CompositeView=r.CollectionView.extend({constructor:function(e){r.CollectionView.apply(this,arguments),this.itemView=this.getItemView()},initialEvents:function(){this.collection&&(this.bindTo(this.collection,"add",this.addChildView,this),this.bindTo(this.collection,"remove",this.removeItemView,this),this.bindTo(this.collection,"reset",this.renderCollection,this))},getItemView:function(e){var t=this.options.itemView||this.itemView||this.constructor;if(!t){var n=new Error("An `itemView` must be specified");throw n.name="NoItemViewError",n}return t},render:function(){var e=this;this.resetItemViewContainer();var t=this.renderModel();return this.$el.html(t),this.bindUIElements(),this.trigger("composite:model:rendered"),this.trigger("render"),this.renderCollection(),this.trigger("composite:rendered"),this},renderCollection:function(){r.CollectionView.prototype.render.apply(this,arguments),this.trigger("composite:collection:rendered")},renderModel:function(){var e={};e=this.serializeData();var t=this.getTemplate();return r.Renderer.render(t,e)},appendHtml:function(e,t){var n=this.getItemViewContainer(e);n.append(t.el)},getItemViewContainer:function(e){var n;if("$itemViewContainer"in e)n=e.$itemViewContainer;else{if(e.itemViewContainer){n=e.$(t.result(e,"itemViewContainer"));if(n.length<=0){var r=new Error("Missing `itemViewContainer`");throw r.name="ItemViewContainerMissingError",r}}else n=e.$el;e.$itemViewContainer=n}return n},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),r.Region=function(e){this.options=e||{};var n=new r.EventBinder;t.extend(this,n,e);if(!this.el){var i=new Error("An 'el' must be specified");throw i.name="NoElError",i}this.initialize&&this.initialize.apply(this,arguments)},t.extend(r.Region.prototype,e.Events,{show:function(e){this.ensureEl(),this.close(),e.render(),this.open(e),e.onShow&&e.onShow(),e.trigger("show"),this.onShow&&this.onShow(e),this.trigger("view:show",e),this.currentView=e},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=this.getEl(this.el)},getEl:function(e){return n(e)},open:function(e){this.$el.html(e.el)},close:function(){var e=this.currentView;if(!e)return;e.close&&e.close(),this.trigger("view:closed",e),delete this.currentView},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),r.Region.extend=e.View.extend,r.Layout=r.ItemView.extend({regionType:r.Region,constructor:function(){this.initializeRegions(),e.Marionette.ItemView.apply(this,arguments)},render:function(){var e=r.ItemView.prototype.render.apply(this,arguments);return this.render=function(){this.closeRegions(),this.reInitializeRegions();var e=r.ItemView.prototype.render.apply(this,arguments);return e},e},close:function(){this.closeRegions(),this.destroyRegions(),e.Marionette.ItemView.prototype.close.call(this,arguments)},initializeRegions:function(){this.regionManagers||(this.regionManagers={});var e=this;t.each(this.regions,function(t,n){var r=typeof t=="string",i=typeof t.selector=="string",s=typeof t.regionType=="undefined";if(!r&&!i)throw new Error("Region must be specified as a selector string or an object with selector property");var o,u;r?o=t:o=t.selector,s?u=e.regionType:u=t.regionType;var a=new u({el:o,getEl:function(t){return e.$(t)}});e.regionManagers[n]=a,e[n]=a})},reInitializeRegions:function(){this.regionManagers&&t.size(this.regionManagers)===0?this.initializeRegions():t.each(this.regionManagers,function(e){e.reset()})},closeRegions:function(){var e=this;t.each(this.regionManagers,function(e,t){e.close()})},destroyRegions:function(){var e=this;t.each(this.regionManagers,function(t,n){delete e[n]}),this.regionManagers={}}}),r.Application=function(e){this.initCallbacks=new r.Callbacks,this.vent=new r.EventAggregator,this.submodules={};var n=new r.EventBinder;t.extend(this,n,e)},t.extend(r.Application.prototype,e.Events,{addInitializer:function(e){this.initCallbacks.add(e)},start:function(e){this.trigger("initialize:before",e),this.initCallbacks.run(e,this),this.trigger("initialize:after",e),this.trigger("start",e)},addRegions:function(e){var t,n,i;for(i in e)e.hasOwnProperty(i)&&(t=e[i],typeof t=="string"?n=new r.Region({el:t}):n=new t,this[i]=n)},removeRegion:function(e){this[e].close(),delete this[e]},module:function(e,t){var n=i.call(arguments);return n.unshift(this),r.Module.create.apply(r.Module,n)}}),r.Application.extend=e.View.extend,r.AppRouter=e.Router.extend({constructor:function(t){e.Router.prototype.constructor.call(this,t);if(this.appRoutes){var n=this.controller;t&&t.controller&&(n=t.controller),this.processAppRoutes(n,this.appRoutes)}},processAppRoutes:function(e,n){var r,i,s,o,u,a=[],f=this;for(s in n)n.hasOwnProperty(s)&&a.unshift([s,n[s]]);o=a.length;for(u=0;u<o;u++){s=a[u][0],i=a[u][1],r=e[i];if(!r){var l="Method '"+i+"' was not found on the controller",c=new Error(l);throw c.name="NoMethodError",c}r=t.bind(r,e),f.route(s,i,r)}}}),r.Module=function(e,n,i){this.moduleName=e,this.submodules={},this._setupInitializersAndFinalizers(),this._config={},this._config.app=n,this._config.customArgs=i,this._config.definitions=[];var s=new r.EventBinder;t.extend(this,s)},t.extend(r.Module.prototype,e.Events,{addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;this._runModuleDefinition(),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.submodules&&t.each(this.submodules,function(t){t.start(e)})},stop:function(){if(!this._isInitialized)return;this._isInitialized=!1,this._finalizerCallbacks.run(),this._setupInitializersAndFinalizers(),t.each(this.submodules,function(e){e.stop()})},addDefinition:function(e){this._config.definitions.push(e)},_runModuleDefinition:function(){if(this._config.definitions.length===0)return;var i=t.flatten([this,this._config.app,e,r,n,t,this._config.customArgs]),s=this._config.definitions.length-1;for(var o=0;o<=s;o++){var u=this._config.definitions[o];u.apply(this,i)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks}}),t.extend(r.Module,{create:function(e,n,s){var o=this,u=e;n=n.split(".");var a=i.apply(arguments);a.splice(0,3);var f=n.length;return t.each(n,function(t,n){var i=n===f-1,l=u[t];l||(l=new r.Module(t,e,a),u[t]=l,u.submodules[t]=l),i&&o._createModuleDefinition(l,s,e),u=l}),u},_createModuleDefinition:function(e,t,n){var r=this._getModuleDefinitionOptions(t);r.definition&&e.addDefinition(r.definition),r.startWithApp&&n.addInitializer(function(t){e.start(t)})},_getModuleDefinitionOptions:function(e){var n={startWithApp:!0};return e?(t.isFunction(e)?n.definition=e:(n.definition=e.define,e.hasOwnProperty("startWithApp")&&(n.startWithApp=e.startWithApp)),n):n}}),r.TemplateCache=function(e){this.templateId=e},t.extend(r.TemplateCache,{templateCaches:{},get:function(e){var t=this,n=this.templateCaches[e];return n||(n=new r.TemplateCache(e),this.templateCaches[e]=n),n.load()},clear:function(){var e,t=arguments.length;if(t>0)for(e=0;e<t;e++)delete this.templateCaches[arguments[e]];else this.templateCaches={}}}),t.extend(r.TemplateCache.prototype,{load:function(){var e=this;if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(t),this.compiledTemplate},loadTemplate:function(e){var t=n(e).html();if(!t||t.length===0){var r="Could not find template: '"+e+"'",i=new Error(r);throw i.name="NoTemplateError",i}return t},compileTemplate:function(e){return t.template(e)}}),r.Renderer={render:function(e,t){var n=typeof e=="function"?e:r.TemplateCache.get(e),i=n(t);return i}},r.Callbacks=function(){this.deferred=n.Deferred(),this.promise=this.deferred.promise()},t.extend(r.Callbacks.prototype,{add:function(e,t){this.promise.done(function(n,r){t&&(n=t),e.call(n,r)})},run:function(e,t){this.deferred.resolve(t,e)}}),r.EventAggregator=r.EventBinder.extend({constructor:function(e){r.EventBinder.apply(this,arguments),t.extend(this,e)},bindTo:function(e,t,n){return r.EventBinder.prototype.bindTo.call(this,this,e,t,n)}}),t.extend(r.EventAggregator.prototype,e.Events),r.EventAggregator.extend=e.View.extend;var i=Array.prototype.slice;return r}(Backbone,_,root.jQuery||root.Zepto||root.ender),typeof module!="undefined"&&module!==null&&(module.exports=Backbone.Marionette),function(){var e,t,n,r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t)c.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=this.Backbone||require("backbone"),o=this._||require("underscore"),n=null,i=null,e.Events.one=function(e,t,n){var r;return r=o.bind(function(){return this.unbind(e,r),t.apply(n||this,arguments)},this),this.bind(e,r)},l=[e.Model,e.View,e.Collection];for(a=0,f=l.length;a<f;a++)r=l[a],(u=r.prototype).one||(u.one=e.Events.one);n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return h(n,t),n.prototype.VERSION="0.3.0",n.prototype.one=e.Events.one,n}(e.Marionette.Application),n=new n,n.manage=function(e){var t;return t=new n.Manager({model:e}),i["interface"].show(t),this.vent.trigger("manage",e,t),t},t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return h(t,e),t.prototype.tagName="div",t.prototype.className="transit-ui",t.prototype.id="transit_ui",t.prototype.template=o.template('<div id="transit_manager"></div>'),t.prototype.regions={"interface":"#transit_manager"},t}(e.Marionette.Layout),n.addInitializer(function(e){return e==null&&(e={}),i=new t,i.render(),$("body").append(i.el)}),s=e.Marionette.Renderer.render,e.Marionette.Renderer.render=function(e,t){return o.isFunction(e)?e(t):(o.isObject(e)&&e.type==="handlebars"&&e.template(o.extend(t,e.data),e.options),s(e,t))},this.Transit||(this.Transit=n),typeof module!="undefined"&&module!==null&&(module.exports=n)}.call(this),function(){var e,t,n;n=navigator.userAgent,e={msie:n.indexOf("MSIE")!==-1&&n.indexOf("Opera")===-1,gecko:n.indexOf("Gecko")!==-1&&n.indexOf("KHTML")===-1,webkit:n.indexOf("AppleWebKit/")!==-1,chrome:n.indexOf("Chrome/")!==-1,opera:n.indexOf("Opera/")!==-1,ios:/ipad|iphone|ipod/i.test(n),android:/android (\d+)/i.test(n)},t=this.Transit||require("transit"),t.browser=this.Transit.browser=e,typeof module!="undefined"&&module!==null&&(module.exports=t.browser)}.call(this),function(){var e,t;t=this.Transit||require("transit"),e=function(){function e(){_.bindAll(this)}return e.prototype.selection=null,e.prototype.cursor=function(){var e,t,n,r;return r=this.get(),r===null?null:(e=$("<span/>"),t=document.createRange(),t.setStart(r.endContainer,r.endOffset),t.insertNode(e.get(0)),n=e.offset(),e.remove(),n)},e.prototype.get=function(){var e,t;return t=null,window.getSelection?(e=window.getSelection(),t=e.rangeCount>0?e.getRangeAt(0):null):document.selection&&document.selection.createRange&&(t=document.selection.createRange()),t},e.prototype.restore=function(e){var t;return e==null&&(e=null),e===null&&(e=this.selection),e===null?!0:(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(e)):document.selection&&e.select&&e.select(),this.selection=null,this)},e.prototype.save=function(){return this.selection=this.get(),this.selection},e}(),t.Selection=this.Transit.Selection=new e,typeof module!="undefined"&&module!==null&&(module.exports=t.Selection)}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},i=[].slice;e=this.Transit||require("transit"),e.Manager=function(n){function s(){return this.onClose=t(this.onClose,this),this.onRender=t(this.onRender,this),s.__super__.constructor.apply(this,arguments)}return r(s,n),s.prototype.className="transit-manager",s.prototype.toolBar=null,s.prototype.ui={heading:"h1"},s.prototype.events={"click button.save":"save"},s.prototype.templateHelpers=function(){var e;return e={heading:"Manage "+this.model.type},e},s.prototype.initialize=function(){return this.render()},s.prototype.add=function(){var e,t;return e=1<=arguments.length?i.call(arguments,0):[],(t=this.toolBar).add.apply(t,e)},s.prototype.onRender=function(){return this.toolBar=new e.Toolbar,this.$el.append(this.toolBar.el)},s.prototype.onClose=function(){return this.toolBar.close()},s.prototype.drop=function(){var e,t;return e=1<=arguments.length?i.call(arguments,0):[],(t=this.toolBar).drop.apply(t,e)},s.prototype.save=function(){return this.model.save()},s.prototype.reset=function(){return this.toolBar.reset()},s}(Backbone.Marionette.ItemView),typeof module!="undefined"&&module!==null&&(module.exports=e.Manager)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Transit.Modal=function(t){function r(){return this.render=e(this.render,this),this.perform=e(this.perform,this),this.close=e(this.close,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.handler=function(){var e=this;return this.$el.modal({show:!0}).one("hidden",function(t){return Transit.vent.trigger("modal:close",e),e.trigger("close")}),this.one("modal:close",function(){return e.$el.modal("hide")})},r.prototype.tagName="div",r.prototype.className="transit-modal",r.prototype.events={"click a[data-action],button[data-action]":"perform"},r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this.on("close",this.remove,this),this.options=_.defaults(this.options,{buttons:[],title:"Title Missing",content:"Content missing"})},r.prototype.close=function(){return this.$el.trigger("hidden"),this.remove(),this},r.prototype.perform=function(e){var t,n;e.preventDefault(),n=$(e.currentTarget),t=n.attr("data-action"),Transit.vent.trigger("modal:action",t,this);if(t==="close")return this.trigger("modal:close")},r.prototype.remove=function(){return this.off(),this.trigger("remove"),r.__super__.remove.apply(this,arguments)},r.prototype.render=function(){var e;return e=$(this.template(this.options)),e.attr("id","transit_modal_"+this.cid),$("#transit_ui").append(e),this.setElement($("#transit_modal_"+this.cid)),this.trigger("open"),Transit.vent.trigger("modal:show",this),this.$el.addClass("out"),this.handler.apply(this),this.$el.removeClass("out").addClass("in"),this},r}(Backbone.View),this.Transit.modal=function(e){var t;return e==null&&(e={}),t=new Transit.Modal(e),Transit.one("modal:show",function(e){if(e!==t)return!1}),t.render(),t}}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this._setup=t(this._setup,this),this._render=t(this._render,this),this.success=t(this.success,this),this.info=t(this.info,this),this.error=t(this.error,this),Transit.one("ready",this._setup)}return e.prototype.template=function(){},e.prototype.error=function(e){return this._render(e,"error")},e.prototype.info=function(e){return this._render(e,"info")},e.prototype.success=function(e){return this._render(e,"success")},e.prototype._render=function(e,t){return Transit.Manager.append($(this.template({message:e,type:t})))},e.prototype._setup=function(){var e=this;return Transit.tpl("/core/notification.jst",function(t){return e.template=t})},e}(),Transit.Notify=new e,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Notify)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=this.Transit||require("transit"),e.Panel=function(e){function t(){var e,n,r,i;t.__super__.constructor.apply(this,arguments),i=["title","icon"];for(n=0,r=i.length;n<r;n++)e=i[n],this.options[e]!==void 0&&(this[e]=this.options[e]);this.$el.attr("id")===void 0&&this.$el.attr("id","transit_panel_"+this.cid)}return n(t,e),t.prototype.tagName="div",t.prototype.className="transit-panel",t.prototype.title="Detail",t.prototype.icon="",t.prototype.active=!1,t}(Backbone.Marionette.ItemView),this.Transit.Panel=e.Panel,typeof module!="undefined"&&module!==null&&(module.exports=e.Panel)}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},s=[].slice;t=this.Transit||require("transit"),t.Toolbar=function(t){function r(){return this.reset=n(this.reset,this),this.drop=n(this.drop,this),this.add=n(this.add,this),r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.tagName="div",r.prototype.className="transit-toolbar",r.prototype.navbar=null,r.prototype.regions={panels:"div.panels:eq(0)"},r.prototype.initialize=function(){return this.render()},r.prototype.add=function(){var t,n,r,i,o,u,a;r=1<=arguments.length?s.call(arguments,0):[],i=this;for(u=0,a=r.length;u<a;u++)n=r[u],this.navbar.find("li[rel='"+n.cid+"']").length===0&&(o=new e({panel:n.cid,title:n.title,icon:n.icon}),this.navbar.append(o.render(n).el),this.panels.attachView(n),t=this,o.on("active",function(){return t.navbar.find("li").removeClass("active"),this.$el.addClass("active"),t.panels.show(this.panel)}),o.panel=n,n.tab=o);if($("> li.active",this.navbar).length===0)return $("a:eq(0)",this.navbar).click()},r.prototype.drop=function(){var e,t,n,r;t=1<=arguments.length?s.call(arguments,0):[];for(n=0,r=t.length;n<r;n++)e=t[n],e.close(),e.tab.close(),delete e.tab,e=null;return this},r.prototype.onRender=function(){var e=this;return this.navbar=this.$("ul.transit-nav-bar"),this.panels.el=this.$("div.panels:eq(0)"),this.panels.getEl=function(){return e.$("div.panels:eq(0)")}},r.prototype.reset=function(){return this.panels.reset(),this},r}(Backbone.Marionette.Layout),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.template=function(){return""},t.prototype.tagName="li",t.prototype.events={"click > a":"choose"},t.prototype.panel=null,t.prototype.initialize=function(){return this.render()},t.prototype.choose=function(e){return e.preventDefault(),this.trigger("active",this)},t.prototype.beforeClose=function(){return this.$("i,a").off().remove(),this.panel=null},t.prototype.onRender=function(){var e,t,n,r;n=_.pick(this.options,"class","icon","id","href","rel","target","title"),this.$el.empty(),e=$("<a></a>");for(t in n){r=n[t];switch(t){case"class":e.addClass(r);break;case"title":e.text(r);break;case"icon":r!==""&&e.prepend($("<i></i>").addClass("icon-"+r));break;default:e.attr(t,r)}}return this.$el.append(e),this.$el.attr("rel",this.options.panel),this},t}(Backbone.Marionette.ItemView),this.Transit.Toolbar=t.Toolbar,typeof module!="undefined"&&module!==null&&(module.exports=t.Toolbar)}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=function(){var e;return XMLHttpRequest===void 0?!1:(e=new XMLHttpRequest,e.upload===void 0?!1:e.upload.onprogress!==void 0)},t=function(){var e;return e=document.createElement("INPUT"),e.type="file",e.files!==void 0},this.Transit.Uploader=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.tagName="div",n.prototype.className="transit-uploader",n["native"]=e(),n}(Backbone.View)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Transit.Asset=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.defaults={deliverable_id:null,deliverable_type:null,urls:[],url:null,image:!0,filename:null},n.prototype.isImage=function(){return this.get("image")},n}(Backbone.Model)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Transit.Assets=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=function(){return Transit.Asset},n.prototype.url=function(){return Transit.settings.asset_path},n.prototype.fetch=function(e){return e==null&&(e={}),e.data=this.deliverable,Backbone.Collection.prototype.fetch.apply(this,[e])},n}(Backbone.Collection)}.call(this),function(){var e,t,n,r=function(e,t){return function(){return e.apply(t,arguments)}},i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=this.Backbone||require("backbone"),n=this._||require("underscore"),t=this.Transit||require("transit"),t.Context=function(e){function n(){return this._cleanup=r(this._cleanup,this),n.__super__.constructor.apply(this,arguments)}return s(n,e),n.build_as="contexts_attributes",n.prototype.type=null,n.prototype.deliverable=null,n.prototype.defaults={_type:null,position:null},n.prototype.view=null,n.prototype._pendingDestroy=!1,n.prototype.initialize=function(){var e,r;return n.__super__.initialize.apply(this,arguments),this.type===null&&(this.get("_type")===null&&this.set("_type",this.constructor.name),this.type=this.get("_type")),e=t.Contexts.load(this.type),this.view===null&&(r={model:this},this.isNew()&&(r.el=".managed-context[data-context-id='#{@id}']"),this.view=new e.view(r)),this.on("change",function(e){var t,n,r;r=e.changes;for(t in r)n=r[t],this.view.trigger("change:"+t);return this.view.trigger("change")}),this.on("destroy",this.cleanup),this.view.render(),this},n.prototype._cleanup=function(){return this.view.remove(),delete this.view},n}(e.Model),typeof module!="undefined"&&module!==null&&(module.exports=t.Context)}.call(this),function(){var e,t,n,r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=this.Backbone||require("backbone"),n=this._||require("underscore"),t=this.Transit||require("transit"),t.Contexts=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,e),r.build_as="contexts_attributes",r.subclasses={},r.load=function(e){return r.subclasses[e]||{model:t.Context,view:t.View}},r.setup=function(e,i){var s,o;return i==null&&(i={}),o=i.model||t.Context,i=n.defaults(i,{model:o,view:o.view||t.View}),s=r.subclasses[e]||{},r.subclasses[e]=n.extend(s,i),r},r.prototype._deliverable=null,r.prototype.model=function(e){var n;return n=t.Contexts.load(e._type),new n.model(e)},r}.call(this,e.Collection),typeof module!="undefined"&&module!==null&&(module.exports=t.Contexts)}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=window.$||Backbone.$,t=function(t){function r(){return this._view_options=n(this._view_options,this),this._build_contexts=n(this._build_contexts,this),this.invalidate=n(this.invalidate,this),r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.contexts=null,r.prototype.type=null,r.prototype.view=null,r.prototype.initialize=function(){return this.type===null&&(this.type=this.constructor.name),this.view||(this.view=new Transit.Region(this._view_options)),this.contexts||(this.contexts=new Transit.Contexts),this.on("change:contexts",this._build_contexts),this._build_contexts(),this},r.prototype.invalidate=function(t,n,r){var i,s,o,u,a;if(n&&n.responseText){o=e.parseJSON(n.responseText);if(o.errors){u=o.errors,a=[];for(i in u)s=u[i],a.push(t.trigger("error:"+i,s));return a}}},r.prototype.toJSON=function(){var e,t;return e={},this.contexts.each(function(t,n){return e[n.toString()]=t.toJSON()}),t={},t[""+Transit.Contexts.build_as]=e,{page:_.extend(r.__super__.toJSON.apply(this,arguments),t)}},r.prototype._build_contexts=function(){var e;return e=this.attributes.contexts||[],this.contexts.reset(e),delete this.attributes.contexts,this},r.prototype._view_options=function(){var e;return e={model:this},this.isNew()&&(e.el="[data-region-id='#{@id}']"),e},r}(Backbone.Model),Transit.Deliverable=t,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Deliverable)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Transit.AssetManager=function(t){function r(){return this.render=e(this.render,this),this.add=e(this.add,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.uploader=null,r.prototype.collection=null,r.prototype.images=null,r.prototype.files=null,r.prototype.title="Assets",r.prototype.attach=function(e){this.model=e;if(this.model.assets===void 0)return this.model.assets=new Transit.Assets},r.prototype.add=function(e){return e.isImage()?this.images.add(e):this.files.add(e)},r.prototype.render=function(){return r.__super__.render.apply(this,arguments),this.$el.addClass("transit-asset-manager"),this.uploader===null&&(this.uploader=new Transit.Uploader,this.$el.prepend(this.uploader.render().$el)),this.files===null&&(this.files=new Transit.AssetManager.List({"class":"files"})),this.images===null&&(this.images=new Transit.AssetManager.List({"class":"images"})),this.$el.append(this.images.render().$el),this.$el.append(this.files.render().$el),this},r}(Transit.Panel),this.Transit.AssetManager.List=function(t){function r(){return this.add=e(this.add,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="ul",r.prototype.initialize=function(){r.__super__.initialize.apply(this,arguments);if(this.options["class"])return this.$el.addClass(this.options["class"])},r.prototype.add=function(e){var t;return t=new Transit.AssetManager.Item({model:e}),this.$el.append(t.render.$el())},r}(Backbone.View),this.Transit.AssetManager.Item=function(t){function r(){return this.remove=e(this.remove,this),this.render=e(this.render,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.events={'click a[data-action="remove"]':"remove"},r.prototype.tagName="li",r.prototype.type=null,r.prototype.template=null,r.prototype.initialize=function(){var e=this;return this.type=this.model.isImage()?"image":"file",this.$el.addClass(this.type),Transit.tpl("/core/assets/"+this.type+".jst",function(t){return e.template=t,e.render()})},r.prototype.render=function(){return this.$el.html(this.template({asset:this.model}))},r.prototype.remove=function(){return confirm("Are you sure you want to delete this "+this.type+"?")?(this.model.destroy(),Transit.trigger("asset:removed",this.model),r.__super__.remove.apply(this,arguments)):!1},r}(Backbone.View)}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=this.Backbone||require("backbone"),t=this.Transit||require("transit"),t.View=function(e){function t(){return this.render=n(this.render,this),t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.tagName="div",t.prototype.className="context",t.prototype.render=function(){return this.$el.attr("data-context-id",this.model.id).attr("data-context-type",this.model.type),this},t}(e.Marionette.ItemView),typeof module!="undefined"&&module!==null&&(module.exports=t.View)}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=this.Transit||require("transit"),e.Region=function(e){function n(){return this.onRender=t(this.onRender,this),n.__super__.constructor.apply(this,arguments)}return r(n,e),n.prototype.tagName="div",n.prototype.className="region",n.prototype.onRender=function(){return this.$el.attr("data-deliverable-id",this.model.id).attr("data-deliverable-type",this.model.type)},n}(Backbone.Marionette.ItemView),typeof module!="undefined"&&module!==null&&(module.exports=e.Region)}.call(this)