(function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},i=[].slice;t=!1,e=null,e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.version="0.3.0",t.prototype.one=function(e,t,n){var r;return r=function(){var s;return s=1<=arguments.length?i.call(arguments,0):[],t.apply(null,s),this.vent.off(e,r,n)},this.vent.on(e,r,n)},t.prototype.set=function(){var e,t;return e=1<=arguments.length?i.call(arguments,0):[],(t=this.cache).set.apply(t,e)},t}(Backbone.Marionette.Application),e=new e,e.manage=function(n,r){var i;return i=function(){var t;return t=new e.Manager({model:n}),typeof r=="function"&&r(t),t},t===!0?i():(this.vent.on("ready",function(){return i(manager)}),this)},e.addInitializer(function(e){e==null&&(e={});if(!_.has(e,"preload"))return t=!0,!0}),this.Transit||(this.Transit=e),typeof module!="undefined"&&module!==null&&(module.exports=e)}).call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.drop=t(this.drop,this),this.set=t(this.set,this),this.get=t(this.get,this)}return e.prototype.view={},e.prototype.context={},e.prototype.tpl={},e.prototype.get=function(e,t){var n;return e=e.toLowerCase(),t=t.toLowerCase(),n=this[e][t],n===void 0?null:n},e.prototype.set=function(e,t,n){return e=e.toLowerCase(),t=t.toLowerCase(),this[e][t]=n},e.prototype.drop=function(e,t){return delete this[e][t],this},e}(),this.Transit.cache=new e}.call(this),function(){var e,t;t=navigator.userAgent,e={msie:t.indexOf("MSIE")!==-1&&t.indexOf("Opera")===-1,gecko:t.indexOf("Gecko")!==-1&&t.indexOf("KHTML")===-1,webkit:t.indexOf("AppleWebKit/")!==-1,chrome:t.indexOf("Chrome/")!==-1,opera:t.indexOf("Opera/")!==-1,ios:/ipad|iphone|ipod/i.test(t),android:/android (\d+)/i.test(t)},Transit.browser=e,typeof module!="undefined"&&module!==null&&(module.exports=Transit.browser)}.call(this),function(){var e;e=function(){function e(){_.bindAll(this)}return e.prototype.selection=null,e.prototype.cursor=function(){var e,t,n,r;return r=this.get(),r===null?null:(e=$("<span/>"),t=document.createRange(),t.setStart(r.endContainer,r.endOffset),t.insertNode(e.get(0)),n=e.offset(),e.remove(),n)},e.prototype.get=function(){var e,t;return t=null,window.getSelection?(e=window.getSelection(),t=e.rangeCount>0?e.getRangeAt(0):null):document.selection&&document.selection.createRange&&(t=document.selection.createRange()),t},e.prototype.restore=function(e){var t;return e==null&&(e=null),e===null&&(e=this.selection),e===null?!0:(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(e)):document.selection&&e.select&&e.select(),this.selection=null,this)},e.prototype.save=function(){return this.selection=this.get(),this.selection},e}(),this.Transit.Selection=new e}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};this.Transit.Template=function(){function t(t,n,r){this.render=e(this.render,this),this.path=t,this.source=n,this.func=r,this}return t.cache={},t.compile=function(e){return _.template(e)},t.find=function(e){var n;return n=t.cache[t.pathify(e)],n===void 0?!1:n},t.pathify=function(e){return e.indexOf(this.url)!==-1?e:""+this.url+"/"+e.replace(/^\//,"")},t.set=function(e,n){var r,i;return e=t.pathify(e),r=t.compile(n),i=new Transit.Template(e,n,r),t.cache[e]=i,i},t.url="/transit/views",t.prototype.path="",t.prototype.source="",t.prototype.func=null,t.prototype.render=function(e){return this.func===null?this.source:this.func(e)},t}.call(this),this.Transit.tpl=function(e,t){var n;return e=Transit.Template.pathify(e),n=Transit.Template.find(e),n===!1?$.get(e,function(n){var r;return r=Transit.Template.set(e,n),t(r)}):t(n)}}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=this.Transit||require("transit"),e.Manager=function(n){function i(){return this.save=t(this.save,this),this.show=t(this.show,this),this.hide=t(this.hide,this),i.__super__.constructor.apply(this,arguments)}return r(i,n),i.prototype.tagName="div",i.prototype.className="transit-ui",i.prototype.id="transit_ui",i.prototype.events={"click button.save":"save"},i.prototype.toolBar=null,i.prototype.initialize=function(){return i.__super__.initialize.apply(this,arguments),this.toolBar=new e.Toolbar,this.render(),$("body").append(this.el),this.append(this.toolBar.el)},i.prototype.append=function(e){return this.$el.append(e)},i.prototype.hide=function(){return this.$el.addClass("hidden"),$("html").addClass("transit-ui-hidden").removeClass("transit-ui-active"),e.vent.trigger("ui:hide"),this},i.prototype.prepend=function(e){return this.$el.prepend(e)},i.prototype.show=function(){return this.$el.removeClass("hidden"),$("html").removeClass("transit-ui-hidden").addClass("transit-ui-active"),e.vent.trigger("ui:show"),this},i.prototype.save=function(e){return e&&e.preventDefault(),this.model?this.model.save:!1},i}(Backbone.Marionette.Layout),this.Transit.Manager=e.Manager,typeof module!="undefined"&&module!==null&&(module.exports=e.Manager)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Transit.Modal=function(t){function r(){return this.render=e(this.render,this),this.perform=e(this.perform,this),this.close=e(this.close,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.handler=function(e){return $(e.$el).modal({show:!0}).one("hidden",function(t){return Transit.trigger("modal:close",e),e.trigger("close"),$("div.modal-backdrop:eq(0)").remove()})},r.prototype.tagName="div",r.prototype.className="transit-modal",r.prototype.events={"click a[data-action]":"perform"},r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this.on("close",this.remove,this),this.options=_.defaults(this.options,{buttons:[],title:"Title Missing",content:"Content missing"})},r.prototype.close=function(){return this.trigger("close"),this.remove(),this},r.prototype.perform=function(e){var t;return e.preventDefault(),t=$(e.currentTarget),Transit.trigger("modal:action",t.attr("data-action"),this)},r.prototype.remove=function(){return this.off(),this.trigger("remove"),r.__super__.remove.apply(this,arguments)},r.prototype.render=function(){var e=this;return Transit.tpl("/core/modal.jst",function(t){var n;return n=$(t.render(e.options)).attr("id","transit_modal_"+e.cid),e.setElement(n),e.trigger("open"),Transit.trigger("modal:show",e),e.$el.addClass("out"),Transit.Modal.handler(e),e.$el.removeClass("out").addClass("in")}),this},r}(Backbone.View),this.Transit.modal=function(e){var t;return e==null&&(e={}),t=new Transit.Modal(e),Transit.one("modal:show",function(e){if(e!==t)return!1}),t.render(),t}}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this._setup=t(this._setup,this),this._render=t(this._render,this),this.success=t(this.success,this),this.info=t(this.info,this),this.error=t(this.error,this),Transit.one("ready",this._setup)}return e.prototype.template=function(){},e.prototype.error=function(e){return this._render(e,"error")},e.prototype.info=function(e){return this._render(e,"info")},e.prototype.success=function(e){return this._render(e,"success")},e.prototype._render=function(e,t){return Transit.Manager.append($(this.template({message:e,type:t})))},e.prototype._setup=function(){var e=this;return Transit.tpl("/core/notification.jst",function(t){return e.template=t})},e}(),Transit.Notify=new e,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Notify)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Transit.Panel=function(e){function n(){var e,t,r,i;n.__super__.constructor.apply(this,arguments),i=["title","icon"];for(t=0,r=i.length;t<r;t++)e=i[t],this.options[e]!==void 0&&(this[e]=this.options[e]);this.$el.attr("id")===void 0&&this.$el.attr("id","transit_panel_"+this.cid)}return t(n,e),n.prototype.tagName="div",n.prototype.className="transit-panel",n.prototype.title="Detail",n.prototype.icon="",n.prototype.active=!1,n}(Backbone.Marionette.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},r=[].slice;this.Transit.Toolbar=function(t){function i(){return this.set=e(this.set,this),this.reset=e(this.reset,this),this.remove=e(this.remove,this),this.render=e(this.render,this),this.add=e(this.add,this),this.initialize=e(this.initialize,this),i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.heading=null,i.prototype.tabBar=null,i.prototype.tagName="div",i.prototype.className="transit-toolbar",i.prototype.id="transit_ui_toolbar",i.prototype.regions={panels:"> div.panels"},i.prototype.initialize=function(){var e=this;return this.render(),this.panels.on("view:closed",function(t){return e.tabBar.remove(t.cid)}),this.heading=this.$("h1")},i.prototype.add=function(){var e,t,n,i,s,o,u=this;n=1<=arguments.length?r.call(arguments,0):[],o=[];for(i=0,s=n.length;i<s;i++)t=n[i],this.tabBar.find(t.cid)===void 0?(this.tabBar.append(t),e=function(e){return e.preventDefault(),u.panels.show(t)},o.push(t.tab.find("a").on("click.transit",e))):o.push(void 0);return o},i.prototype.render=function(){return i.__super__.render.apply(this,arguments),this.tabBar===null&&(this.tabBar=new Transit.Toolbar.TabBar),this.tabBar.list.find("a:eq(0)").click(),this},i.prototype.remove=function(e){return e.close()},i.prototype.reset=function(){return this.panels.reset(),this.tabBar.reset(),this},i.prototype.set=function(e,t){switch(e){case"heading":this.heading.html(t);break;default:return!1}return!0},i}(Backbone.Marionette.Layout),this.Transit.Toolbar.TabBar=function(t){function r(){return this.reset=e(this.reset,this),this.render=e(this.render,this),this.remove=e(this.remove,this),this.prepend=e(this.prepend,this),this.build=e(this.build,this),this.insert=e(this.insert,this),this.find=e(this.find,this),this.change=e(this.change,this),this.append=e(this.append,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.list=null,r.prototype.tabs={},r.prototype.initialize=function(){return this.render()},r.prototype.append=function(e){return this.list.append(this.build(e))},r.prototype.change=function(e){return $("li",this.list).removeClass("active"),this.find(e)===void 0?!0:(this.find(e).addClass("active"),this)},r.prototype.find=function(e){return $(this.tabs[e])},r.prototype.insert=function(e,t){var n;return n=this.build(t),e<_.size(this.tabs)?this.el.append(n):this.list.find("> li").eq(e).after(n)},r.prototype.build=function(e){var t,n,r,i,s,o,u;t=e.cid,o=e.title,n=$("<li></li>"),r=$("<a></a>").text(o),s=_.pick(e,"class","icon","id","href","rel","target");if(_.has(this.tabs,t))return this.tabs[t];for(i in s){u=s[i];switch(i){case"class":r.addClass(u);break;case"icon":r.prepend($("<i></i>").addClass("icon-"+u));break;default:r.attr(i,u)}}return r.attr({href:e.$el.attr("id")}).text(o),n.append(r).attr({id:"#transit_panel_tab_"+t}),this.tabs[t]=n,e.tab=r,n},r.prototype.prepend=function(e){return this.list.prepend(this.build(e))},r.prototype.remove=function(e){var t;return t=this.find(e),t.off(".transit").find("a").off(".transit"),delete this.tabs[e],t.remove()},r.prototype.render=function(){return this.$el&&this.$el.remove(),this.$el=$(this.template()),this.list=this.$("ul.transit-nav-bar"),this},r.prototype.reset=function(){var e,t,n,r,i,s;i=this.tabs,s=[];for(e=n=0,r=i.length;n<r;e=++n)t=i[e],s.push(this.remove(t));return s},r}(Backbone.View)}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=function(){var e;return XMLHttpRequest===void 0?!1:(e=new XMLHttpRequest,e.upload===void 0?!1:e.upload.onprogress!==void 0)},t=function(){var e;return e=document.createElement("INPUT"),e.type="file",e.files!==void 0},this.Transit.Uploader=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.tagName="div",n.prototype.className="transit-uploader",n["native"]=e(),n}(Backbone.View)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Transit.Asset=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.defaults={deliverable_id:null,deliverable_type:null,urls:[],url:null,image:!0,filename:null},n.prototype.isImage=function(){return this.get("image")},n}(Backbone.Model)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Transit.Assets=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=function(){return Transit.Asset},n.prototype.url=function(){return Transit.settings.asset_path},n.prototype.fetch=function(e){return e==null&&(e={}),e.data=this.deliverable,Backbone.Collection.prototype.fetch.apply(this,[e])},n}(Backbone.Collection)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Transit.Context=function(t){function r(){return this._cleanup=e(this._cleanup,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.build_as="contexts_attributes",r.prototype.view=null,r.prototype.type=null,r.prototype.deliverable=null,r.prototype.defaults={_type:null,position:null},r.prototype._pendingDestroy=!1,r.prototype.initialize=function(){var e;return r.__super__.initialize.apply(this,arguments),this.type===null&&(this.get("_type")===null&&this.set("_type",this.constructor.name),this.type=this.get("_type")),this.view===null&&(e={model:this},this.isNew()&&(e.el=".managed-context[data-context-id='#{@id}']"),this.view=this.constructor.view===void 0?new Transit.View(e):new this.constructor.view(e)),this.on("change",function(e){var t,n,r;r=e.changes;for(t in r)n=r[t],this.view.trigger("change:"+t);return this.view.trigger("change")}),this.on("destroy",this.cleanup),this.view.render(),this},r.prototype._cleanup=function(){return this.view.remove(),delete this.view},r}(Backbone.Model)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.build_as="contexts_attributes",t.prototype._deliverable=null,t.prototype.model=function(e){var t;return t=Transit.get("context",e._type),t!==null?new t(e):new Transit.Context(e)},t}(Backbone.Collection),Transit.Contexts=e,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Contexts)}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=window.$||Backbone.$,t=function(t){function r(){return this._view_options=n(this._view_options,this),this._build_contexts=n(this._build_contexts,this),this.invalidate=n(this.invalidate,this),r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.contexts=null,r.prototype.type=null,r.prototype.view=null,r.prototype.initialize=function(){return this.type||(this.type=this.constructor.name),this.view||(this.view=new Transit.Region(this._view_options)),this.contexts||(this.contexts=new Transit.Contexts),this.on("change:contexts",this._build_contexts),this._build_contexts(),this},r.prototype.invalidate=function(t,n,r){var i,s,o,u,a;if(n&&n.responseText){o=e.parseJSON(n.responseText);if(o.errors){u=o.errors,a=[];for(i in u)s=u[i],a.push(t.trigger("error:"+i,s));return a}}},r.prototype.toJSON=function(){var e,t;return e={},this.contexts.each(function(t,n){return e[n.toString()]=t.toJSON()}),t={},t[""+Transit.Contexts.build_as]=e,{page:_.extend(r.__super__.toJSON.apply(this,arguments),t)}},r.prototype._build_contexts=function(){var e;return e=this.attributes.contexts||[],this.contexts.reset(e),delete this.attributes.contexts,this},r.prototype._view_options=function(){var e;return e={model:this},this.isNew()&&(e.el="[data-region-id='#{@id}']"),e},r}(Backbone.Model),Transit.Deliverable=t,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Deliverable)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Transit.AssetManager=function(t){function r(){return this.render=e(this.render,this),this.add=e(this.add,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.uploader=null,r.prototype.collection=null,r.prototype.images=null,r.prototype.files=null,r.prototype.title="Assets",r.prototype.attach=function(e){this.model=e;if(this.model.assets===void 0)return this.model.assets=new Transit.Assets},r.prototype.add=function(e){return e.isImage()?this.images.add(e):this.files.add(e)},r.prototype.render=function(){return r.__super__.render.apply(this,arguments),this.$el.addClass("transit-asset-manager"),this.uploader===null&&(this.uploader=new Transit.Uploader,this.$el.prepend(this.uploader.render().$el)),this.files===null&&(this.files=new Transit.AssetManager.List({"class":"files"})),this.images===null&&(this.images=new Transit.AssetManager.List({"class":"images"})),this.$el.append(this.images.render().$el),this.$el.append(this.files.render().$el),this},r}(Transit.Panel),this.Transit.AssetManager.List=function(t){function r(){return this.add=e(this.add,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="ul",r.prototype.initialize=function(){r.__super__.initialize.apply(this,arguments);if(this.options["class"])return this.$el.addClass(this.options["class"])},r.prototype.add=function(e){var t;return t=new Transit.AssetManager.Item({model:e}),this.$el.append(t.render.$el())},r}(Backbone.View),this.Transit.AssetManager.Item=function(t){function r(){return this.remove=e(this.remove,this),this.render=e(this.render,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.events={'click a[data-action="remove"]':"remove"},r.prototype.tagName="li",r.prototype.type=null,r.prototype.template=null,r.prototype.initialize=function(){var e=this;return this.type=this.model.isImage()?"image":"file",this.$el.addClass(this.type),Transit.tpl("/core/assets/"+this.type+".jst",function(t){return e.template=t,e.render()})},r.prototype.render=function(){return this.$el.html(this.template({asset:this.model}))},r.prototype.remove=function(){return confirm("Are you sure you want to delete this "+this.type+"?")?(this.model.destroy(),Transit.trigger("asset:removed",this.model),r.__super__.remove.apply(this,arguments)):!1},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Transit.View=function(t){function r(){return this.render=e(this.render,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="div",r.prototype.className="context",r.prototype.render=function(){return this.$el.attr("data-context-id",this.model.id).attr("data-context-type",this.model.type),this},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=this.Transit||require("transit"),e.Region=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t}(Backbone.View)}.call(this)