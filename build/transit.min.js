(function(){var e,t,n,r,i,s,o=function(e,t){return function(){return e.apply(t,arguments)}},u=[].slice;e=this.$||Backbone.$,t=function(){function e(){this.set=o(this.set,this),this.get=o(this.get,this)}return e.prototype.view={},e.prototype.context={},e.prototype.get=function(e,t){var n;return e=e.toLowerCase(),t=t.toLowerCase(),n=this[e][t],n===void 0?null:n},e.prototype.set=function(e,t,n){return e=e.toLowerCase(),t=t.toLowerCase(),this[e][t]=n},e}(),n={template_path:"/transit/views",asset_path:"/transit/assets"},r={_cache:{},compile:function(e){return _.template(e)},load:function(t,n){var r;return r=i.Template,r[t]!==void 0?n(r[t]):e.get(""+s("template_path")+"/"+t,function(e){var i;return i=r.compile(e),r[t]=i,n(i)})},set:function(e,t){return typeof t=="string"?this._cache[e]=this.compile(t):this._cache[e]=t}},i=this.Transit={},i.cache=new t,i.settings=n,i.Template=r,i.setup=function(e){return e==null&&(e={}),i.settings=_.extend(i.settings,e)},i.on=Backbone.Events.on,i.trigger=Backbone.Events.trigger,i.off=Backbone.Events.off,i.one=function(e,t,n){var r;return r=function(){var s;return s=1<=arguments.length?u.call(arguments,0):[],t.apply(null,s),i.off(e,r,n)},i.on(e,r,n)},i.set=i.cache.set,i.get=i.cache.get,i.init=function(e){return i.Manager.attach(e),i.trigger("init")},s=function(e){return i.settings[e]},this.Transit}).call(this),function(){var e,t,n,r,i=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},u=[].slice;e=window.$||Backbone.$,t=function(t){function n(){return this._save=i(this._save,this),this._removeTab=i(this._removeTab,this),this._addTab=i(this._addTab,this),this.show=i(this.show,this),this.setHeading=i(this.setHeading,this),this.render=i(this.render,this),this.hide=i(this.hide,this),n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.tagName="div",n.prototype.className="transit-ui",n.prototype.events={"click button.save":"_save"},n.prototype.Panels=null,n.prototype._heading=null,n.prototype._tabbar=null,n.prototype.initialize=function(){return Transit.one("init",this.render),this.Panels=new r,this.Panels.on("add",this._addTab),this.Panels.on("remove",this._removeTab)},n.prototype.add=function(){var e,t;return e=1<=arguments.length?u.call(arguments,0):[],(t=this.Panels).add.apply(t,e)},n.prototype.append=function(e){return this.$el.append(e)},n.prototype.attach=function(e){return this.model=e,this},n.prototype.hide=function(){return this.$el.addClass("hidden"),e("html").addClass("transit-ui-hidden").removeClass("transit-ui-active"),Transit.trigger("ui:hide"),this},n.prototype.prepend=function(e){return this.$el.prepend(e)},n.prototype.render=function(){return e("#transit_ui").length===0&&(n.__super__.render.apply(this,arguments),e("html").addClass("transit-ui-hidden"),this.$el.addClass("hidden").append("<h1>Title</h1>").append('<ul class="transit-tab-bar"></ul>').attr("id","transit_ui").appendTo(e("body")),this.$el.append(this.Panels.render().$el),this._tabbar=this.$("ul.transit-tab-bar"),this._heading=this.$("h1")),this},n.prototype.setHeading=function(e){return this._heading.html(e)},n.prototype.show=function(){return this.$el.removeClass("hidden"),e("html").removeClass("transit-ui-hidden").addClass("transit-ui-active"),Transit.trigger("ui:show"),this},n.prototype._addTab=function(t){var n=this;return this._tabbar.append("      <li class='tab' id='panel_tab_"+t.cid+"' data-panel='"+t.cid+"'>        <a href='#', class='"+t.icon+"' data-panel='"+t.cid+"'>"+t.title+"</a>      </li>"),this.$("a[data-panel='"+t.cid+"']").on("click",function(r){return e("li.tab a",n._tabbar).removeClass("active"),r.preventDefault(),t.trigger("active")})},n.prototype._removeTab=function(t){return e("#panel_tab_"+t.cid).remove()},n.prototype._save=function(e){return e&&e.preventDefault(),this.model?this.model.save:!1},n}(Backbone.View),r=function(t){function n(){return this._add=i(this._add,this),this.remove=i(this.remove,this),this.removeAll=i(this.removeAll,this),this.change=i(this.change,this),this.add=i(this.add,this),n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.tagName="div",n.prototype.className="panels",n.prototype.initialize=function(){return this.panels=[],this.on("change",this.change),this.add.apply(this,arguments)},n.prototype.add=function(){var e,t,n,r,i;t=1<=arguments.length?u.call(arguments,0):[],i=_.flatten([t]);for(n=0,r=i.length;n<r;n++)e=i[n],this._add(e);return this},n.prototype.change=function(){var e,t,n,r,i,s,o;t=arguments[0],e=2<=arguments.length?u.call(arguments,1):[],s=this.panels,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],n===t?o.push(n.activate.apply(n,e)):(n.trigger("inactive"),o.push(n.deactivate.apply(n,e)));return o},n.prototype.removeAll=function(){return this.remove.apply(this,this.panels)},n.prototype.remove=function(){var e,t,n,r,i,s;t=1<=arguments.length?u.call(arguments,0):[],i=_.flatten([t]),s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(e.remove());return s},n.prototype._add=function(t){var n=this;return t.on("active",function(){var r;return r=1<=arguments.length?u.call(arguments,0):[],e("#panel_tab_"+t.cid).addClass("active"),n.trigger.apply(n,["change",t].concat(u.call(r)))}),t.on("remove",function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],n.panels.indexOf(t)!==-1&&n.panels.splice(n.panels.indexOf(t),1),n.trigger.apply(n,["remove",t].concat(u.call(e)))}),this.panels.push(t),this.trigger("add",t),this.$el.append(t.render().$el)},n}(Backbone.View),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.tagName="div",t.prototype.className="transit-panel",t.prototype.title="Detail",t.prototype.icon="",t.prototype.active=!1,t.prototype.initialize=function(){return _.bindAll(this)},t.prototype.activate=function(){return this.active=!0,this.$el.addClass("active")},t.prototype.deactivate=function(){return this.active=!1,this.$el.removeClass("active")},t.prototype.remove=function(){return t.__super__.remove.apply(this,arguments),this.trigger("remove",this)},t}(Backbone.View),Transit.Manager=new t,Transit.Panel=n,typeof module!="undefined"&&module!==null&&(module.exports={Panel:n,Manager:t})}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=function(e){function n(){return this._setType=t(this._setType,this),this._cleanup=t(this._cleanup,this),n.__super__.constructor.apply(this,arguments)}return r(n,e),n.build_as="contexts_attributes",n.prototype.view=null,n.prototype.type=null,n.prototype._pendingDestroy=!1,n.prototype.initialize=function(){var e;return this._setType(),this.view===null&&(e=Transit.get("view",this.type),e===null&&(e=Transit.get("view","Context")),this.isNew()?this.view=new e({model:this}):this.view=new e({model:this,el:".managed-context[data-context-id='#{@id}']"})),this.on("change",function(e){var t,n,r;r=e.changes;for(t in r)n=r[t],this.view.trigger("change:"+t);return this.view.trigger("change")}),this.on("destroy",this.cleanup),this.view.render(),this},n.prototype._cleanup=function(){return this.view.remove(),delete this.view},n.prototype._setType=function(){return this.type!==null?!0:(this.has("_type")||this.set("_type",this.constructor.name),this.type=this.get("_type"))},n}(Backbone.Model),Transit.Context=e,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Context)}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=window.$||Backbone.$,t=function(t){function r(){return this._build_contexts=n(this._build_contexts,this),this.invalidate=n(this.invalidate,this),r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.contexts=null,r.prototype.initialize=function(){return this.contexts||(this.contexts=new Transit.Contexts),this.on("change:contexts",this._build_contexts),this._build_contexts(),this},r.prototype.invalidate=function(t,n,r){var i,s,o,u,a;if(n&&n.responseText){o=e.parseJSON(n.responseText);if(o.errors){u=o.errors,a=[];for(i in u)s=u[i],a.push(t.trigger("error:"+i,s));return a}}},r.prototype.toJSON=function(){var e,t;return e={},this.contexts.each(function(t,n){return e[n.toString()]=t.toJSON()}),t={},t[""+Transit.Contexts.build_as]=e,{page:_.extend(r.__super__.toJSON.apply(this,arguments),t)}},r.prototype._build_contexts=function(){var e;return e=this.attributes.contexts||[],this.contexts.reset(e),delete this.attributes.contexts,this},r}(Backbone.Model),Transit.Deliverable=t,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Deliverable)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.build_as="contexts_attributes",t.prototype._deliverable=null,t.prototype.model=function(e){var t;return t=Transit.get("context",e._type),t!==null?new t(e):new Transit.Context(e)},t}(Backbone.Collection),Transit.Contexts=e,typeof module!="undefined"&&module!==null&&(module.exports=Transit.Contexts)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t}(Backbone.View),Transit.set("view","Context",e)}.call(this)